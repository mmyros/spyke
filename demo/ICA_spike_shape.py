totalnspikes = 1000
data = np.zeros((totalnspikes, 50), np.float64)

#for spikei, spike in enumerate(s.spikes[:nspikes]): # s is the Sort object
spikei = 0
nspikes = 0
spikei = 0
while nspikes < totalnspikes:
    spike = s.spikes[spikei]
    nchans = spike['nchans']
    chans = spike['chans'][0:nchans]
    chani = chans.searchsorted(spike['chan'])
    signal = s.get_wavedata(spikei)[chani]
    spikei += 1
    if len(signal) != 50:
        continue # skip spikes that have some lockout, not worth the indexing trouble
    data[nspikes] = signal
    nspikes += 1

import py_ica

# sometimes this goes into an infinite loop for some reason, try setting
# maxsteps to something other than None
act, weights, resid = py_ica.ExtendedInfomax(maxsteps=100, verbose=1).run(data, nfac=2)


data = np.array([[ -270.,  -550.,  -795.,  -845.,  -667.,  -333.,   129.,   667.,  1118.,  1344.,  1394.,  1303.,   988.,   344.,  -372.,  -862., -1010.,
         -913.,  -644.,  -276.,    38.,    -4.,  -716., -1928., -2911., -3087., -2835., -2659., -2451., -1777.,  -936.,  -426.,  -228.,   182.,
         1042.,  2118.,  2927.,  3319.,  3566.,  3994.,  4389.,  4332.,  3745.,  2984.,  2374.,  1988.,  1744.,  1507.,  1239.,  1004.],
       [  454.,   578.,   630.,   503.,   243.,    47.,     5.,    86.,    99.,   -36.,  -187.,  -251.,    36.,   477.,   902.,  1010.,   873.,
          797.,  1194.,  1991.,  2400.,  1584.,  -368., -2578., -4128., -4755., -4674., -4182., -3287., -2025.,  -719.,    34.,   -10.,  -570.,
        -1102., -1243., -1053.,  -771.,  -674.,  -712.,  -814.,  -830.,  -678.,  -353.,   -67.,    20.,    86.,   344.,   515.,   269.],
       [ -327.,  -291.,  -360.,  -354.,  -224.,   -93.,  -106.,  -246.,  -333.,  -299.,  -266.,  -456.,  -721.,  -822.,  -488.,    48.,   302.,
           67.,  -194.,   -19.,   190.,  -237., -1429., -2699., -3521., -3692., -3424., -2876., -2193., -1332.,  -375.,   586.,  1426.,  2154.,
         2694.,  3040.,  3123.,  3028.,  2771.,  2530.,  2425.,  2475.,  2378.,  1998.,  1660.,  1704.,  2041.,  2171.,  1892.,  1366.],
       [-1101.,  -989.,  -912.,  -783.,  -549.,  -427.,  -567.,  -754.,  -799.,  -944., -1354., -1561., -1089.,  -177.,   483.,   671.,   626.,
          567.,   516.,   382.,   155.,  -144.,  -498., -1114., -1938., -2580., -2526., -1792.,  -816.,   -80.,   360.,   780.,  1471.,  2339.,
         3054.,  3390.,  3373.,  3083.,  2686.,  2406.,  2355.,  2375.,  2226.,  1819.,  1311.,   945.,   816.,   844.,   774.,   451.],
       [   36.,   438.,   991.,  1146.,   668.,  -158.,  -891., -1275., -1286., -1054.,  -740.,  -530.,  -353.,  -129.,   157.,   463.,   691.,
          911.,  1318.,  1832.,  1739.,   173., -2939., -6479., -8806., -8910., -7131., -4688., -2556.,  -952.,   216.,   943.,  1246.,  1365.,
         1557.,  1908.,  2223.,  2219.,  1912.,  1594.,  1409.,  1276.,  1252.,  1526.,  2053.,  2459.,  2428.,  1986.,  1465.,  1192.],
       [ -368.,  -139.,   132.,   243.,   118.,  -179.,  -532.,  -806.,  -869.,  -661.,  -297.,   -77.,  -161.,  -555.,  -970., -1130., -1052.,
         -822.,  -450.,   193.,  1061.,  1561.,   555., -2499., -6406., -8889., -8705., -6473., -3527.,  -760.,  1424.,  2856.,  3648.,  4047.,
         4250.,  4351.,  4266.,  3876.,  3337.,  2901.,  2465.,  1711.,   778.,   168.,    50.,    27.,  -198.,  -525.,  -808., -1020.],
       [  734.,   805.,  1031.,  1256.,  1357.,  1400.,  1445.,  1389.,  1052.,   541.,    57.,  -217.,  -312.,  -192.,    16.,   118.,   -35.,
         -259.,  -467.,  -893., -1708., -2585., -3082., -3326., -3548., -3585., -3161., -2570., -2187., -1916., -1330.,  -381.,   645.,  1456.,
         1961.,  2100.,  2059.,  2126.,  2454.,  2711.,  2601.,  2168.,  1744.,  1431.,  1197.,  1087.,  1162.,  1323.,  1417.,  1514.],
       [ -308.,   -89.,   -53.,  -346.,  -737.,  -819.,  -662.,  -698., -1002., -1174., -1011.,  -780.,  -563.,  -263.,    25.,    50.,  -118.,
           25.,   630.,  1330.,  1711.,  1431.,  -166., -3262., -6393., -7370., -5648., -2718.,  -149.,  1713.,  3144.,  4239.,  4929.,  5166.,
         4939.,  4379.,  3723.,  3125.,  2629.,  2199.,  1797.,  1414.,  1143.,  1022.,   904.,   590.,   194.,    -5.,  -104.,  -437.],
       [ -776.,  -712.,  -605.,  -580.,  -671.,  -717.,  -513.,   -30.,   422.,   473.,   182.,   -97.,   -77.,   116.,   290.,   480.,   811.,
         1418.,  2161.,  2646.,  2513.,  1492.,  -817., -4249., -7180., -7594., -5374., -2348.,     0.,  1632.,  2827.,  3434.,  3532.,  3538.,
         3466.,  3002.,  2311.,  1924.,  1893.,  1709.,  1136.,   457.,   -11.,  -310.,  -674., -1151., -1458., -1292.,  -804.,  -536.],
       [-1720., -1522., -1259.,  -859.,  -312.,   324.,   957.,  1459.,  1684.,  1599.,  1501.,  1672.,  2078.,  2334.,  2265.,  1953.,  1621.,
         1311.,   736.,  -219., -1150., -1603., -2003., -3085., -4730., -5876., -5740., -4439., -2615.,  -823.,   742.,  2103.,  3247.,  3965.,
         4185.,  4027.,  3595.,  2993.,  2492.,  2242.,  1891.,   959.,  -366., -1506., -2212., -2697., -2925., -2675., -2093., -1642.]])
